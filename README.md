# Обзор

Специальный модуль Google-OAuth предоставляет дополнительный функционал по авторизации и создания пользователей в системе
через сторонние системы идентификации.

# Начало работы

## Установка Google-OAuth Add-on

Для того, чтобы у пользователя появилась возможность использовать add-on в CUBA.platform приложении
необходимо произвести установку add-on в локальный репозиторий пользователя. Рекомендуется делать эту
процедуру в Cuba Studio, для этого импортируйте add-on в Cuba Studio и выполните `Run` -> `Install app component`.

## Подключение Google-OAuth Add-on в CUBA.platform App

Данную операцию рекомендуется выполнять в Cuba Studio. Откройте проект в Cuba Studio и
перейдите к редактированию его своств (`Project properties` -> `Edit`). Нажмите на `+` расположенный
рядом с надписью `Custom components`. В выподающем спике (второе поле) должен быть доступен компонент
с именем `google-oauth` (в случае если вы выполнили его установку ранее). Выберите компонент, нажмите `ok`,
сохраните настройки проекта. Google-OAuth Add-on подключен.

## Описание предметной модели
Модуль расширяет базовые возможности по сторонней авторизации и идентификации. Невозможно моментально создать всех
требуемых пользователей в системе или необходимо создавать пользователей из уже существующих внешних систем с получением существущих данных.
Так же часто необходимо иметь возможность идентифицировать и регистрировать пользователей с внешних клиентских приложений (мобильные, вебсайт).
Все указанные требования выполняет данный подключаемый модуль.

На данный момент внешняя идентификация пользователей работает с провайдером Google.

Таким образом модуль реализовывает три сценария использования:
*1*. Система сама является клиентом внешней системы аутентификации пользователей. Перенаправляет запрос на идентификацию во внешнюю систему, получая обратно результат.
В случае необходимости получает данные, которые могут быть использованы для создания пользователей в системе.
*2*. Система является промежуточным звеном. Получая запросы от внешних клиентов с их базовыми данными, система перенаправляет запрос на внешнюю систему, обрабатывает результат, и
выдает данные для доступа.
*3*. Система является конечной точкой цепочки авторизации. Внешние клиентские системы сами получают все необходимые данные, присылая их на проверку основной системе.
Система проверяет полученные данные, и, в случае успеха, идентифицирует пользователей.

Рассмотрим каждый вариант использования более подробно.

# Система является клиентом внешней системы аутентификации


# Система является промежуточным звеном


# Система является валидатором конечных данных


# Дополнение A: Свойства модуля.

## Основные свойства

### google.appId

* __Description:__ Идентификатор приложения в системе Google. Идентификатор необходим для распознания в Google работающей системы.

* __Type:__ Используется на middleware уровне

* __Interface:__ *GoogleConfig*

### google.appSecret

* __Description:__ Секретный ключ приложения в системе Google использующийся в паре с *google.appId*

* __Type:__ Используется на middleware уровне

* __Interface:__ *GoogleConfig*

### google.scope

* __Description:__ Тип собираемых данных при авторизации через Google. Хранится в виде json массива с перечислением требуемых данных.

* __Default value:__ *["https://www.googleapis.com/auth/plus.me","https://www.googleapis.com/auth/userinfo.email"]*

* __Type:__ Используется на middleware уровне

* __Interface:__ *GoogleConfig*

### google.createUser.domains

* __Description:__ Домены аккаунтов разрешенных для создания пользователей в случае их отсутствия в системе. При пустом значении пользователи не будут созданы.

* __Type:__ Используется на middleware уровне

* __Interface:__ *GoogleConfig*

### google.external.appId

* __Description:__ Внешний Google идентификатор клиентских приложений который используется при валидации идентификации через клиентские приложения.

* __Type:__ Используется на middleware уровне

* __Interface:__ *GoogleConfig*

### google.external.accessTokenLoginEnabled

* __Description:__ Разрешена ли идентификация клиентских приложений через специальный access token

* __Default value:__ *true*

* __Type:__ Используется на middleware уровне

* __Interface:__ *GoogleConfig*

### google.external.idTokenLoginEnabled

* __Description:__ Разрешена ли идентификация клиентских приложений через специальный id token

* __Default value:__ *true*

* __Type:__ Используется на middleware уровне

* __Interface:__ *GoogleConfig*

### google.createUser.group

* __Description:__ Группа пользователей по умолчанию назначаемая новым пользователям, созданным при первой авторизации в системе через модуль.

* __Default value:__ *0fa2b1a5-1d68-4d69-9fbd-dff348347f93*

* __Type:__ Используется на middleware уровне

* __Interface:__ *GoogleConfig*
